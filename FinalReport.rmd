---
title: "Covid91 vaccine study Final2021"
author: "Daniel A Soria Zuniga!"
date: "summer 2021"
output: 
    html_document:
    toc: true
    toc_depth: 5
---





```{r include=FALSE,echo=FALSE}
require(tidyverse)
require(tigerstats)
require(forcats)
OldData <-read.csv(file="covid91.csv",header=TRUE)
#recode to remove the annoying "X" from the dataframe
FinalData <- OldData %>% mutate(infected = recode(infected, aids = "covid", none = "OK" )) %>% select(-one_of("X"))
FinalData <- FinalData %>%
mutate(across(where(is.character), as.factor))
FinalData$treatment <- relevel(FinalData$treatment,ref = "placebo")
#FinalData$treatment <- relevel(FinalData$treatment,ref = "OK")      
guy = filter(FinalData, sex =="guy")
gal = filter(FinalData, sex =="gal")
gay = filter(FinalData, LGBTQ =="gay")
Druguser = filter(FinalData, DrugUser =="yes")
```

# Introduction

A new  preventative vaccine (covid 19) is under test in clinical trials. Given the nature of this vaccine it is suspected that the drug may exhibit different effectiveness across the variety of subpopulations tracked. Consider population subgroups by gender( guys and gals), drug use, and sexual orientation. Write a complete report that separately considers this drug for each subgroup and your recommendations as to whether people in the subgroup should take the vaccine. Structure your report in four sections each devoted to one of the four subgroups, use null and alternative hypothesis statements and correct statistical verbiage when referencing p-values in conclusions.

# Coding details

First the variables from FinalData needed to be changed from character variables into factor variables. The appropiate dplyr code was used to do this. The following code was used to achive this :

FinalData <- FinalData %>%
mutate(across(where(is.character), as.factor))

Next, specific subgroups had to be seperated from the broader categories in order to be properly studied. gal and guy were separted into subgroups, as well as gay sexual orientation and people that answered yes to participating in drug use . All of these categories are isolated to see wether or not these particular populations should or should not take the new Covid-19 vaccine.

In order to create the effectiveness intgerval for all the four categories,each group of people in the study had to be stored in seperate variables.



# Guys

### Barplot



```{r}
dd2 <- guy %>% group_by(infected,treatment) %>% summarize(count=n()) %>% mutate(prcnt=count/sum(count))


# the group_by followed by summerize(count=n())

basicC <- ggplot(dd2,aes(x=infected,y=count,fill=treatment))
basicC + geom_bar(stat="identity",position="dodge")

# Now for percentage Plot

basicC <- ggplot(dd2,aes(x=infected,y=prcnt*100,fill=treatment))
basicC + geom_bar(stat="identity",position="dodge")
```




This plot represents the population of guys(males) people and the relationship to the contraction of covid-19 and either taking the vaccine or the placebo.


The plot above shows amazingly that 58% of the people that took the vaccine did in fact get covid-19, while only approximatly 42% of the people taking the placebo contracted covid-19 in contrary to those who were only given the placebo, in this model the vaccine appears to be innefective in protecting the population againts covid-19, the odds of contracting covid-19 while taking the vaccine is 3:2. The guys that took the drug were one and a half times more likely to get covid-19 than those taking the placebo.


In the first plot the x-axis represents the infected, and wether those participatns were infected or not, as the y-axis represented the number of people that contracted covid-19. In the second plot the two left bars represent all the people that contracted covid-19, while the x-axis represents wether they got covid-19 or not, and now represents the people that got covid-19 and if they took the placebo or not.



The codes that create this plot start with the code block begining with dd2,dd2 can be seen in the enviorment pane and if inspected contains 4 variables., These varibvles include the infected ,treatment, count,and prcnt(percent), the second group of codes is called the basicC, which also can be seen in the enviorment pane and contains a total of 9 varibales , this information helps us create the first plot the basicC is also in the files pane and also includes 9 variables which create the second plot.

### numerical Results

```{r}
table1 <- xtabs(~infected + treatment,data = guy)
rowPerc(table1)
colPerc(table1)
```

These numerical results show specific percentages of guys(men) that got covid-19 after taking the placebo and taking the vaccine.
Among the men 58% got covid-19 after taking the vaccine,while only approximately 42% of the guys given the placebo contracted covid-19,this allows us to see that the vaccine is  not effective and would not be recomended in guys(males) because those who took the vaccine actually had a higher chance to contract covid.
The odds of contracting covid-19 while taking the vaccine were 3:2, the men that took the drug were one and a half times more likely to get covid-19 than those taking the placebo.


### Inferential



```{r}
chisq.test(table1)
chisqtestGC(table1)
guysfish <- fisher.test(table1)
guysfish
```


This is very importan information to pay close attention to, as among all of the previous results this is the  Fishers exact test, which we can see that the p-value is extremely small at 0.0006181, this is a tremendously small number meaning thay these results are extremely unlikely to happen by chance.



The null hypothesis predicted that the deaths related to covid-19 are indipendent of sex, scince it is clear that sex does play a role in the death rate of individuals,, the alternative hypothesis, that there is a correlation between covid-19 deaths, and sex is a favorable option.

The odd ratio above illustartes a ratio of 0.68, in the guys(men) who recived the vaccine were 1.5 times more likely to contract covid-19 contrary to those who revieved the placeo.


```{r}
effect <- guysfish$p.value/(guysfish$p.value +1)
effectivenessguy = guysfish$estimate/(guysfish$estimate +1)*100
print(effectivenessguy)
```

```{r}
low=(guysfish$conf.int[1]/(guysfish$conf.int[1] +1))*100
hi=(guysfish$conf.int[2]/(guysfish$conf.int[2] +1))*100
options(digits = 2)
```

### effectiveness confidence interval 'r low' to 'r hi'



above is the effectiveness for covid 19 vaccine for males(guys) , if the effectiveness  is above 50% that means that the vaccine is effective, based on the interval seen above, we can conclude that the vaccine is innefective in protecting guys from contracting covid-19.

The odds ratio is approximately how effective the vaccine is, as we can see the odds ratio above for men is 40, the effectiveness confidence interval for men is 35.09 to 45.94


# Gals


### Barplot


```{r}
dd2 <- gal %>% group_by(infected,treatment) %>% summarize(count=n()) %>% mutate(prcnt=count/sum(count))


# the group_by followed by summerize(count=n())

basicC <- ggplot(dd2,aes(x=infected,y=count,fill=treatment))
basicC + geom_bar(stat="identity",position="dodge")

# Now for percentage Plot

basicC <- ggplot(dd2,aes(x=infected,y=prcnt*100,fill=treatment))
basicC + geom_bar(stat="identity",position="dodge")
```

This plot represents the populations of gals (females) and the relationship to the contraction of covid-19 by either taking the vaccine or the plcebo.

This chart is very different from the one above of guys, as it appears that more people who were only given the placebo contracted covid-19, as only approximatly 33% of the people given the vaccine contracted the virus,, meaning that around 67% of the people that contracted covid 19 were people that were only administered the placebo, it appears that the odds of contracting covid while vaccinated in this groop are 1:2, as the gals thhat took the vaccine were 1/2 likely to contract covid.
















































































